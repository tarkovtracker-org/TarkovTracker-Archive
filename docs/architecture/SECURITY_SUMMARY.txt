================================================================================
                   TARKOVTRACKER SECURITY SUMMARY
================================================================================

AUTHENTICATION

- API requests must present `Authorization: Bearer <token>`.
- Tokens are stored in `token/{tokenId}` and validated by
  `functions/src/middleware/auth.ts`.
- Sensitive ops (account deletion) also verify Firebase ID tokens via
  `functions/src/middleware/reauth.ts`.

PERMISSIONS

- `requirePermission('GP'|'TP'|'WP')` gatekeeps every handler.
- Tokens list their granted scopes; missing scopes return 403 before business logic.

RATE LIMITING (see `functions/src/middleware/abuseGuard.ts`)

- Applies to POST/PUT/PATCH/DELETE by default.
- Environment overrides: `ABUSE_GUARD_WINDOW_MS`, `_THRESHOLD`, `_WARN_RATIO`, `_BREACH_LIMIT`, `_PATH_PREFIXES`.
- Counts per hashed token or IP; warns at 80% and blocks after the configured breach limit.
- Events logged to `rateLimitEvents` for monitoring.

VALIDATION

- `ValidationService.ts` enforces numeric ranges (levels 1-79, editions 1-6), enums
  (`WP`, `TP`, `GP`, `USEC`, `BEAR`, task states), and sanitized strings (no `<>"'&`).
- Frontend helpers in `frontend/src/utils/DataValidationService.ts` mirror the same checks.
- Error responses are normalized via `middleware/errorHandler.ts` with `success: false`.

FIRESTORE RULES (see `firestore.rules`)

- `progress/{userId}`: owner or same team read; structured payload with valid game mode bits.
- `token/{tokenId}`: owner-only read/update/delete; only `calls` and `note` are mutable.
- `team/{teamId}`: owner controls members/max members (â‰¤50); members can self-remove.
- Helpers like `memberOfSameTeam()` and `validUserData()` make the rules readable.

CORS AND INFRASTRUCTURE

- `functions/src/config/corsConfig.ts` blocks `null`, `file://`, private IPs in prod,
  embedded credentials, and invalid formats before middleware runs.
- Allowed origins in development are limited to `localhost` and `127.0.0.1` variants.
- Credentials are never reflected; headers/methods are static lists (`ALLOW_HEADERS`, `ALLOW_METHODS`).

MONITORING

- All security events log owner, path, and status to Firebase Functions logger.
- Rate limit breaches, CORS denials, and validation failures surface in the logs.
- Use Firebase console alerting on spikes in 401/403/429 responses or
  `rateLimitEvents` writes.
